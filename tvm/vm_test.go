package tvm

import (
	"encoding/hex"
	"github.com/xssnick/tonutils-go/tvm/cell"
	"github.com/xssnick/tonutils-go/tvm/tuple"
	"github.com/xssnick/tonutils-go/tvm/vm"
	"math/big"
	"testing"
)

func TestTVM_Execute(t *testing.T) {
	v := NewTVM()

	walletV3CodeBytes, _ := hex.DecodeString("b5ee9c720101010100710000deff0020dd2082014c97ba218201339cbab19f71b0ed44d0d31fd31f31d70bffe304e0a4f2608308d71820d31fd31fd31ff82313bbf263ed44d0d31fd31fd3ffd15132baf2a15144baf2a204f901541055f910f2a3f8009320d74a96d307d402fb00e8d101a4c8cb1fcb1fcbffc9ed54")
	code, _ := cell.FromBOC(walletV3CodeBytes)

	walletV3DataBytes, _ := hex.DecodeString("b5ee9c7201010101002a0000500000002a29a9a317f7a26c623ca2429ae80fbb17786b0b523ba71c1dbb13fbcdb8ded762a71cd867")
	data, _ := cell.FromBOC(walletV3DataBytes)

	s := vm.NewStack()
	_ = s.PushInt(big.NewInt(85143))

	err := v.Execute(code, data, tuple.Tuple{}, vm.Gas{}, s)
	if err != nil {
		t.Fatal(err)
	}

	t.Log(s.String())
}

func TestTVM_ExecuteManyGet(t *testing.T) {
	v := NewTVM()

	walletV3CodeBytes, _ := hex.DecodeString("b5ee9c72010214010003b7000114ff00f4a413f4bcf2c80b0102016202030202ca0405020120121302012006070201d2101101ddd0831c02497c138007434c0c05c6c2544d7c0fc08783e903e900c7e800c5c75c87e800c7e800c1cea6d0000b4c7e08403e29fa954882ea54c4d167c07b8208405e3514654882ea58c511100fc07f80d60841657c1ef14842ea50c167c08381b08a0842cf6ecbe2eb8c096e103fcbc208020120090a0060ed44d0d300fa00fa40fa40d430345144c705f28d048040d721d30030443404c8cb005003fa0201cf1601cf16ccc9ed540011bdf48860e175e5c29b0201f40b0c01f700f4cffe803e90087c05bb513434c03e803e903e90350c093c96d44de8548af1c17cb8b04a70bffcb8b0950d549c15180104d50541413232c01400fe808073c58073c5b332487232c044fd0004bd0032c032483e401c1d3232c0b281f2fff274017e903d010c7e800835d270803cb8b11de0063232c1540273c59c200d01f33b513434c03e803e903e90350c0274cffe80145468017e903e9014d731c1551cdb9c15180104d50541413232c01400fe808073c58073c5b332487232c044fd0004bd0032c0327e401c1d3232c0b281f2fff2741403b1c1476c7cb8b0c2fe80146e6860822625a020822625a004ad822860823938702806684a200e00c2fa0218cb6b13cc8210178d4519c8cb1f1acb3f5008fa0222cf165007cf1626fa025004cf16c95006cc2491729171e25009a814a08208e4e1c0aa008208989680a0a015bcf2e2c505c98040fb00504404c8cb005003fa0201cf1601cf16ccc9ed5401f68e38528aa019a182107362d09cc8cb1f5230cb3f58fa025008cf165008cf16c9718010c8cb0524cf165007fa0216cb6a15ccc971fb001035103497104a1039385f04e226d70b01c30024c200b08e238210d53276db708010c8cb055009cf165005fa0217cb6a13cb1f13cb3fc972fb0050039410266c32e24003040f002404c8cb005003fa0201cf1601cf16ccc9ed5400e53b513434c03e803e903e90350c0234cffe803e900c1454685492b1c17cb8b04a30bffcb8b0a0823938702a8005e805ef3cb8b0e0841ef765f7b232c7c5b2cfd4013e8088f3c58073c5b25c60063232c14973c59c3e80b2dab33260103ec01409013232c01400fe808073c58073c5b3327b5520008f200835c87b513434c03e803e903e90350c0174c7e08405e3514654882ea0841ef765f784ee84ac7cb8b174cfcc7e800c04e800d409013232c01400fe808073c58073c5b3327b55200023bfd8176a26869807d007d207d206a18360a40023be1b576a26869807d007d207d206a182f824")
	code, _ := cell.FromBOC(walletV3CodeBytes)

	s := vm.NewStack()
	_ = s.PushInt(big.NewInt(115562))

	err := v.Execute(code, cell.BeginCell().EndCell(), tuple.Tuple{}, vm.Gas{}, s)
	if err != nil {
		t.Fatal(err)
	}

	t.Log(s.String())
}
